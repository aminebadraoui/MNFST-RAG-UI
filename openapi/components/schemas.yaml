components:
  schemas:
    # Core Entities
    User:
      type: object
      required:
        - id
        - email
        - name
        - role
      properties:
        id:
          type: string
          format: uuid
          description: Unique user identifier
        email:
          type: string
          format: email
          description: User's email address (unique across all tenants)
        name:
          type: string
          description: User's full name
        role:
          $ref: '#/components/schemas/UserRole'
        tenantId:
          type: string
          format: uuid
          description: Tenant ID (null for superadmin)
          nullable: true
        createdAt:
          type: string
          format: date-time
          description: User creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp
          nullable: true
        lastLogin:
          type: string
          format: date-time
          description: Last login timestamp
          nullable: true

    UserRole:
      type: string
      enum:
        - superadmin
        - tenant_admin
        - user
      description: User role in the system

    Tenant:
      type: object
      required:
        - id
        - name
        - slug
        - createdAt
      properties:
        id:
          type: string
          format: uuid
          description: Unique tenant identifier
        name:
          type: string
          description: Tenant display name
        slug:
          type: string
          description: URL-safe tenant identifier
        createdAt:
          type: string
          format: date-time
          description: Tenant creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp
          nullable: true
        userCount:
          type: integer
          description: Number of users in tenant
          readOnly: true
        documentCount:
          type: integer
          description: Number of documents in tenant
          readOnly: true

    Document:
      type: object
      required:
        - id
        - filename
        - originalName
        - size
        - mimeType
        - status
        - uploadedAt
      properties:
        id:
          type: string
          format: uuid
          description: Unique document identifier
        filename:
          type: string
          description: Stored filename (system-generated)
        originalName:
          type: string
          description: Original upload filename
        size:
          type: integer
          format: int64
          description: File size in bytes
        mimeType:
          type: string
          description: MIME type of the file
        status:
          $ref: '#/components/schemas/DocumentStatus'
        uploadedAt:
          type: string
          format: date-time
          description: Upload timestamp
        processedAt:
          type: string
          format: date-time
          description: Processing completion timestamp
          nullable: true
        error:
          type: string
          description: Error message if processing failed
          nullable: true

    DocumentStatus:
      type: string
      enum:
        - uploaded
        - processing
        - processed
        - error
      description: Document processing status

    SocialLink:
      type: object
      required:
        - id
        - url
        - platform
        - addedAt
      properties:
        id:
          type: string
          format: uuid
          description: Unique social link identifier
        url:
          type: string
          format: uri
          description: Social media URL
        platform:
          $ref: '#/components/schemas/SocialPlatform'
        addedAt:
          type: string
          format: date-time
          description: Link addition timestamp

    SocialPlatform:
      type: string
      enum:
        - twitter
        - facebook
        - linkedin
        - instagram
        - youtube
        - other
      description: Social media platform type

    Session:
      type: object
      required:
        - id
        - title
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
          description: Unique session identifier
        title:
          type: string
          description: Session title
        createdAt:
          type: string
          format: date-time
          description: Session creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp

    Message:
      type: object
      required:
        - id
        - content
        - role
        - timestamp
      properties:
        id:
          type: string
          format: uuid
          description: Unique message identifier
        content:
          type: string
          description: Message content
        role:
          $ref: '#/components/schemas/MessageRole'
        timestamp:
          type: string
          format: date-time
          description: Message timestamp

    MessageRole:
      type: string
      enum:
        - user
        - assistant
      description: Message role in conversation

    # Request/Response DTOs
    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User email
        password:
          type: string
          format: password
          description: User password

    LoginResponse:
      type: object
      required:
        - user
        - tokens
      properties:
        user:
          $ref: '#/components/schemas/User'
        tokens:
          $ref: '#/components/schemas/Tokens'

    Tokens:
      type: object
      required:
        - accessToken
        - refreshToken
        - expiresIn
      properties:
        accessToken:
          type: string
          description: JWT access token
        refreshToken:
          type: string
          description: JWT refresh token
        expiresIn:
          type: integer
          description: Access token expiration time in seconds

    RefreshTokenRequest:
      type: object
      required:
        - refreshToken
      properties:
        refreshToken:
          type: string
          description: JWT refresh token

    RefreshTokenResponse:
      type: object
      required:
        - accessToken
        - expiresIn
      properties:
        accessToken:
          type: string
          description: New JWT access token
        expiresIn:
          type: integer
          description: Access token expiration time in seconds

    CreateTenantRequest:
      type: object
      required:
        - name
        - slug
        - adminUser
      properties:
        name:
          type: string
          description: Tenant name
        slug:
          type: string
          description: URL-safe tenant identifier
        adminUser:
          $ref: '#/components/schemas/CreateUserRequest'

    CreateTenantResponse:
      type: object
      required:
        - id
        - name
        - slug
        - createdAt
        - adminUser
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        slug:
          type: string
        createdAt:
          type: string
          format: date-time
        adminUser:
          type: object
          required:
            - id
            - email
            - name
            - role
          properties:
            id:
              type: string
              format: uuid
            email:
              type: string
              format: email
            name:
              type: string
            role:
              $ref: '#/components/schemas/UserRole'

    CreateUserRequest:
      type: object
      required:
        - email
        - name
        - password
        - role
      properties:
        email:
          type: string
          format: email
          description: User email
        name:
          type: string
          description: User name
        password:
          type: string
          format: password
          description: User password
        role:
          $ref: '#/components/schemas/UserRole'

    CreateUserResponse:
      type: object
      required:
        - id
        - email
        - name
        - role
        - tenantId
        - createdAt
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        name:
          type: string
        role:
          $ref: '#/components/schemas/UserRole'
        tenantId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time

    CreateSessionRequest:
      type: object
      required:
        - title
      properties:
        title:
          type: string
          description: Session title

    SendMessageRequest:
      type: object
      required:
        - content
        - role
      properties:
        content:
          type: string
          description: Message content
        role:
          type: string
          enum: [user]
          description: Message role (always 'user' for sent messages)
        stream:
          type: boolean
          description: Whether to request streaming response
          default: false

    StreamChunk:
      type: object
      required:
        - type
      properties:
        type:
          type: string
          enum: [start, token, end, error]
          description: Stream event type
        messageId:
          type: string
          format: uuid
          description: Message ID (for start/end events)
        content:
          type: string
          description: Token content (for token events)
        complete:
          type: boolean
          description: Whether streaming is complete
          default: false
        error:
          type: string
          description: Error message (for error events)

    AddLinkRequest:
      type: object
      required:
        - url
      properties:
        url:
          type: string
          format: uri
          description: Social media URL

    UploadStatusResponse:
      type: object
      required:
        - uploadId
        - status
        - documents
      properties:
        uploadId:
          type: string
          format: uuid
          description: Upload identifier
        status:
          type: string
          enum: [processing, completed, error]
          description: Overall upload status
        documents:
          type: array
          items:
            $ref: '#/components/schemas/DocumentUploadStatus'

    DocumentUploadStatus:
      type: object
      required:
        - id
        - filename
        - status
        - progress
      properties:
        id:
          type: string
          format: uuid
          description: Document ID
        filename:
          type: string
          description: Document filename
        status:
          $ref: '#/components/schemas/DocumentStatus'
        progress:
          type: integer
          minimum: 0
          maximum: 100
          description: Upload progress percentage
        processedAt:
          type: string
          format: date-time
          description: Processing completion timestamp
          nullable: true
        error:
          type: string
          description: Error message if processing failed
          nullable: true

    MultipleUploadResponse:
      type: object
      required:
        - uploadId
        - documents
      properties:
        uploadId:
          type: string
          format: uuid
          description: Upload identifier
        documents:
          type: array
          items:
            $ref: '#/components/schemas/Document'

    # Response Wrappers
    ApiResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          description: Whether the request was successful
        data:
          description: Response data
        message:
          type: string
          description: Success message
        meta:
          $ref: '#/components/schemas/ResponseMeta'

    ApiError:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          example: false
          description: Always false for error responses
        error:
          $ref: '#/components/schemas/ErrorDetail'
        meta:
          $ref: '#/components/schemas/ResponseMeta'

    ErrorDetail:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: Machine-readable error code
        message:
          type: string
          description: Human-readable error message
        details:
          type: string
          description: Additional error details
          nullable: true

    ResponseMeta:
      type: object
      required:
        - timestamp
        - requestId
      properties:
        timestamp:
          type: string
          format: date-time
          description: Response timestamp
        requestId:
          type: string
          description: Unique request identifier

    # Pagination
    PaginationParams:
      type: object
      properties:
        page:
          type: integer
          minimum: 1
          default: 1
          description: Page number
        limit:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
          description: Items per page

    PaginatedResponse:
      type: object
      required:
        - data
        - pagination
      properties:
        data:
          type: array
          items:
            description: Array of items
        pagination:
          $ref: '#/components/schemas/PaginationInfo'

    PaginationInfo:
      type: object
      required:
        - page
        - limit
        - total
        - totalPages
      properties:
        page:
          type: integer
          description: Current page number
        limit:
          type: integer
          description: Items per page
        total:
          type: integer
          description: Total number of items
        totalPages:
          type: integer
          description: Total number of pages